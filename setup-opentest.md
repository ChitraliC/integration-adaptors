# Set up an OpenTest Connection

In order to perform end-to-end testing of the MHS Adaptor, you will require access to an NHS Digital test environment. The MHS adaptor connects to the following 
two test endpoints which are available in an NHS Digital test environment:

* Spine Core Mocked endpoint - which you will use to send and receive messages
* SDS mocked directory - which is used to lookup routing and reliability information

NHS Digital provides OpenTest as an environment which can be used to perform test activities where an HSCN connection is not available. See [https://digital.nhs.uk/services/spine/open-access-test-environment-for-spine-opentest](https://digital.nhs.uk/services/spine/open-access-test-environment-for-spine-opentest) 
for an introduction to OpenTest.

A summary of the steps required to get up and running with OpenTest is provided below:

## Set up OpenTest Account

Request access to OpenTest via sa.servicedesk@nhs.net as per https://nhs-digital-opentest.github.io/Welcome/index.html
You will be provided with:
* A VPN login, plus connection instructions and a password
* Your IP address on the VPN network
* Spine Party key and ASID details
* Service locations on the network, and Spine 2 Core service URLs
* An endpoint certificate and private key, both as separate files and a PKCS#12 chain.
* Copies of the root CA and endpoint sub CA
* An .ovpn configuration file for connecting to the VPN

## Connect to the OpenTest VPN with OpenVPN
In order to connect to OpenTest you must be connected to the VPN:

* Download and install OpenVPN from: https://openvpn.net/community-downloads/
* Launch OpenVPN GUI - the OpenVPN instance opens in the system tray not as a window
* From the system tray right click and select "Import File" and select the `.ovpn` VPN configuration file that was provided by the platforms support desk
* Click "Connect"
* You should now be connected (the icon in the system tray will have a green indicator)
* To verify you are actually connected correctly, hover over the system tray OpenVPN icon and assert that the assigned IP address matches the "IP address on the VPN network" sent as part of the account setup email. 
 
## Alternatively Connecto to the OpenTest VPN with Tunnelblick
In order to connect to OpenTest you must be connected to the VPN:

* Download and install Tunnelblick from: https://tunnelblick.net/downloads.html

### Troubleshooting TunnelBlick

* 'comp-lzo' is depreciated, open config file and change 'comp-lzo' to 'compress lzo', this will ignore it completely.
* Add config file to Tunnelblick folder, and drag and drop config file to Tunnelblick icon.
* Make sure these files do not exist:(may only exist if openvpn was previously installed)
    - /Library/Extensions/tap.kext
	- /Library/Extensions/tun.kext
	- /Library/StartupItems/tap
	- /Library/StartupItems/tun
* Tennelblick -> VPN Details -> settings -> advanced settings -> ensure 'never load tap driver' is selected.
* Follow steps in link for security & privacy: https://tunnelblick.net/cKextLoadErrorHighSierra.html

## Diagnose issues 

When connected to OpenTest via your OpenVPN client, an instance of Splunk is available to help you diagnose any application issues you may experience when
using the service endpoints which OpenTest provides.

Please contact platforms.supportdesk@nhs.net for details.