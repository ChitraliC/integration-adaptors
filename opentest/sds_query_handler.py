from ldap3 import Connection

OPEN_TEST_SDS_URL = 'msg.opentest.hscic.gov.uk'


def get_permissioned_opentest_endpoints(asid):
    conn = Connection(OPEN_TEST_SDS_URL, auto_bind=True)
    conn.search(search_base='ou=services, o=nhs',
                search_filter='(&(objectClass=nhsAs) (uniqueIdentifier={}))'.format(asid),
                attributes=['nhsAsSvcIA'])

    if conn.entries:
        print('{} permissioned endpoints for asid: "{}"'.format(len(conn.entries[0].nhsAsSvcIA.values), asid))
        for entry in conn.entries[0].nhsAsSvcIA.values:
            print(' - {}'.format(entry))
    else:
        print('No endpoints defined or asid: {} is not valid'.format(asid))


if __name__ == "__main__":
    # add your asid which was provided by the opentest support team
    asid = '<REPLACE_ME>'
    get_permissioned_opentest_endpoints(asid)
